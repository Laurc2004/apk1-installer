# APK1 Installer 完整开发指南

## 📱 项目简介

APK1 Installer 是一个Android应用，专门用来处理`.apk1`和`.apk.1`文件。它能自动将这些文件重命名为`.apk`并调用系统安装器进行安装，让用户无需手动重命名文件。

### 🎯 解决的问题
- QQ、微信等应用传输APK文件时会重命名为`.apk.1`
- 某些应用分发平台使用`.apk1`扩展名
- 用户需要手动重命名为`.apk`才能安装
- 这个应用自动化了整个过程

### ✨ 主要功能
- 🔄 **自动重命名**：`.apk1` / `.apk.1` → `.apk`
- 📱 **一键安装**：自动调用系统安装器
- 🔗 **文件关联**：系统默认用此应用打开这些文件
- 👻 **隐藏图标**：可隐藏应用图标（拨号`*#*#1234#*#*`恢复）
- ⚡ **自动安装**：可设置跳过确认直接安装
- 🛡️ **隐私保护**：详细的隐私政策和权限说明

## 🚀 快速开始（5分钟搞定）

### 第一步：检查Java环境
打开命令行，输入：
```bash
java -version
```
如果显示版本信息（推荐Java 11或17），继续下一步。
如果没有，请先安装Java：[下载地址](https://adoptium.net/)

### 第二步：打开项目
1. 启动 **IntelliJ IDEA Ultimate**
2. 选择 `Open` 或 `File` → `Open`
3. 选择项目文件夹：`c:\Users\Ruichao Lau\code\own\apk1-installer`
4. 点击 `OK`

### 第三步：等待项目加载
- IDEA会自动下载依赖（类似npm install）
- 底部状态栏显示"Gradle sync"进度
- **耐心等待**，首次可能需要5-10分钟

### 第四步：配置Android SDK
如果提示"Android SDK not found"：
1. `File` → `Settings` → `Languages & Frameworks` → `Android SDK`
2. 点击 `Edit` 按钮
3. 选择 `Download Android SDK`
4. 安装路径选择默认即可
5. 等待下载完成（需要网络）

### 第五步：连接真机测试
1. 手机连接电脑（USB线）
2. 手机开启"开发者选项"：
   - 设置 → 关于手机 → 连续点击"版本号"7次
3. 开启"USB调试"：
   - 设置 → 开发者选项 → USB调试
4. 在IDEA的设备下拉菜单中选择你的手机
5. 点击绿色的 **运行按钮** ▶️

## 🏗️ 项目架构详解

### 技术栈
- **语言**: Kotlin (Google推荐的Android开发语言)
- **UI框架**: Android原生 + Material Design
- **构建工具**: Gradle (类似于npm/webpack，但用于Android)
- **IDE**: IntelliJ IDEA Ultimate (Android Studio的基础版本)

### 项目结构
```
apk1-installer/
├── app/                          # 应用模块（类似于src目录）
│   ├── build.gradle             # 应用级构建配置（类似package.json）
│   └── src/main/
│       ├── java/com/apk1installer/  # 源代码目录
│       │   ├── MainActivity.kt      # 主界面（类似index.html的控制器）
│       │   ├── SettingsActivity.kt  # 设置页面
│       │   ├── PrivacyActivity.kt   # 隐私政策页面
│       │   ├── SettingsFragment.kt  # 设置片段
│       │   ├── PhoneStateReceiver.kt # 拨号代码监听器
│       │   └── utils/              # 工具类（类似utils文件夹）
│       │       ├── ApkInstaller.kt  # APK安装工具
│       │       └── PreferenceManager.kt # 设置管理
│       ├── res/                    # 资源文件（类似assets）
│       │   ├── layout/            # 界面布局（类似HTML模板）
│       │   ├── values/            # 字符串、颜色等（类似CSS变量）
│       │   └── xml/               # 配置文件
│       └── AndroidManifest.xml    # 应用清单（类似web.config）
├── gradle/                       # Gradle包装器（类似node_modules）
├── build.gradle                  # 项目级构建配置
└── settings.gradle              # 项目设置
```

### 核心代码解析

#### MainActivity.kt - 主界面
```kotlin
class MainActivity : AppCompatActivity() {
    // 类似于React组件的主类
    // 处理文件选择、APK安装等核心功能
}
```

#### ApkInstaller.kt - 核心工具类
```kotlin
object ApkInstaller {
    // 类似于一个工具模块
    // 包含APK安装、文件处理等方法
}
```

## 🔧 功能实现原理

### 1. 文件处理流程
```
用户选择.apk1/.apk.1/.apk文件 → 复制到临时目录 → 重命名为.apk（如需要） → 调用系统安装器
```

### 2. 权限管理
- `REQUEST_INSTALL_PACKAGES`: 安装APK权限
- `READ_PHONE_STATE`: 监听拨号代码（用于恢复隐藏图标）

### 3. 隐藏图标功能
- 使用PackageManager禁用应用图标
- 通过拨号代码 `*#*#1234#*#*` 恢复

### 4. 文件类型支持
- 支持 `.apk1` 文件（应用分发平台常用格式）
- 支持 `.apk.1` 文件（QQ、微信传输后的格式）
- 支持 `.apk` 文件（标准Android安装包）
- 自动识别并处理三种格式

## 📱 真机测试指南

### 准备工作
1. **开启开发者选项**：
   - 设置 → 关于手机 → 连续点击"版本号"7次
   - 会提示"您已成为开发者"

2. **开启USB调试**：
   - 设置 → 开发者选项 → USB调试（开启）
   - 设置 → 开发者选项 → USB安装（开启，如果有的话）

3. **连接电脑**：
   - 使用USB数据线连接手机和电脑
   - 手机会弹出"允许USB调试"对话框，点击"确定"

### 运行测试
1. 在IDEA中选择你的手机设备
2. 点击运行按钮 ▶️
3. 应用会自动安装到手机上
4. 测试各项功能

### 功能测试清单
- [ ] 选择`.apk1`文件并安装
- [ ] 选择`.apk.1`文件并安装
- [ ] 测试自动安装设置
- [ ] 测试隐藏图标功能
- [ ] 测试拨号代码恢复：`*#*#1234#*#*`
- [ ] 测试文件关联（双击文件是否用此应用打开）

## 🛠️ 构建和发布

### 调试版本
```bash
./gradlew assembleDebug
```
生成的APK位置：`app/build/outputs/apk/debug/app-debug.apk`

### 发布版本
1. 创建签名密钥
2. 配置签名信息
3. 构建发布版本：
```bash
./gradlew assembleRelease
```

## 🐛 常见问题排查

### 环境问题
**Q: Gradle同步失败？**
A: 检查网络连接，可能需要科学上网下载依赖

**Q: 找不到Android SDK？**
A: `File` → `Settings` → `Languages & Frameworks` → `Android SDK`

**Q: Java版本不对？**
A: 确保安装Java 11或17，检查JAVA_HOME环境变量

### 设备问题
**Q: 手机连接不上？**
A: 
1. 确保开启了USB调试
2. 尝试更换USB线或USB端口
3. 安装手机厂商的USB驱动

**Q: 应用安装失败？**
A: 
1. 检查手机是否允许"未知来源"应用安装
2. 确保手机存储空间充足
3. 查看IDEA底部的错误日志

### 功能问题
**Q: 无法选择文件？**
A: 检查应用是否有存储权限

**Q: 安装APK失败？**
A: 
1. 确保APK文件完整且未损坏
2. 检查目标APK的签名是否有效
3. 查看系统安装器的错误提示

## 💡 开发技巧

### 调试技巧
1. **使用Logcat**：查看应用运行日志
   - IDEA底部 → Logcat标签
   - 过滤包名：`com.apk1installer`

2. **断点调试**：
   - 在代码行号左侧点击设置断点
   - 使用Debug模式运行应用

3. **布局检查**：
   - `Tools` → `Layout Inspector`
   - 实时查看界面层次结构

### 代码技巧
1. **快捷键**：
   - `Ctrl+Alt+L`：格式化代码
   - `Alt+Enter`：自动导入/修复
   - `Ctrl+Shift+F`：全局搜索

2. **代码生成**：
   - `Alt+Insert`：生成构造函数、getter/setter等
   - `Ctrl+O`：重写方法

## 📚 学习资源

### Kotlin基础
- [Kotlin官方文档](https://kotlinlang.org/docs/)
- [Kotlin语法速查](https://kotlinlang.org/docs/basic-syntax.html)

### Android开发
- [Android官方开发指南](https://developer.android.com/guide)
- [Material Design指南](https://material.io/design)

### 工具使用
- [IntelliJ IDEA使用指南](https://www.jetbrains.com/help/idea/)
- [Gradle构建工具](https://gradle.org/guides/)

## 🔒 权限说明

应用需要以下权限：
- `REQUEST_INSTALL_PACKAGES`: 安装APK文件
- `READ_PHONE_STATE`: 监听拨号代码（用于图标恢复）
- `READ_EXTERNAL_STORAGE`: 读取APK文件

所有权限都有明确的使用目的，不会收集用户隐私信息。

## 📄 许可证

MIT License - 详见 [LICENSE](./LICENSE) 文件

---

**开发状态**: ✅ 功能完整，支持真机测试  
**支持格式**: `.apk1` 和 `.apk.1`

这个指南包含了您需要的所有信息。如有疑问，请随时询问！